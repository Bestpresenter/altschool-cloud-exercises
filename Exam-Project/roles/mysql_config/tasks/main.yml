---
# tasks file for mysql_config

- name: update
  command: apt update

- name: install mysql
  apt: name="{{mysql_apt}}" state=latest

- name: mysql verson
  command: mysql --version
  
# - name: Create database user with name 'root' and password '***' with all database privileges
#   mysql_user:
#     name: michael
#     password: Ifiekemi1990
#     priv: '*.*:ALL'
#     state: present
#     login_unix_socket: /run/mysqld/mysqld.sock

# - name: Removes anonymous user account for localhost
#   mysql_user:
#     name: ''
#     host: localhost
#     state: absent
#     login_unix_socket: /run/mysqld/mysqld.sock

# - name: Removes all anonymous user accounts
#   mysql_user:
#     name: ''
#     host_all: yes
#     state: absent

# - name: remove mysql test database
#   mysql_db:
#     name: test
#     state: absent
#     login_unix_socket: /var/run/mysql/mysqld.sock

- name: create app_mysql db
  mysql_db:
    name: "{{mysql_db}}"
    state: present
    login_unix_socket: /var/run/mysql/mysqld.sock

- name: create mysql user and grant access to db
  mysql_user:
    name: "{{mysql_user}}"
    password: "{{mysql_pass}}"
    priv: "{{mysql_db}}.*:ALL"
    state: present
    login_unix_socket: /var/run/mysql/mysqld.sock
  no_log: true
